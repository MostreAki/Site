<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catálogo | MostreAki</title>
<style>
  :root{
    --bg:#fff; --ink:#0b0b0b; --card-bg:#f5f5f5; --whats:#25D366;
    --shadow:0 6px 20px rgba(0,0,0,.10);
  }
  *{ box-sizing:border-box }
  body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink) }
  .wrap{ max-width:1100px; margin-inline:auto; padding:20px }

  /* HEADER (sem mascote) */
  .hero{ display:grid; grid-template-columns:140px 1fr; align-items:center; gap:20px; margin:6px 0 22px }
  .logo{ width:140px; aspect-ratio:1/1; border-radius:50%; object-fit:cover; box-shadow:var(--shadow); background:#eee }
  .title{ text-align:center; font-size:clamp(26px,4.2vw,40px); font-weight:800; letter-spacing:.2px }
  @media (max-width:700px){ .hero{ grid-template-columns:1fr; justify-items:center } }

  /* GRID: 4 desktop, 3 tablet, 2 mobile */
  .grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:22px }
  @media (max-width:1000px){ .grid{ grid-template-columns:repeat(3,1fr) } }
  @media (max-width:700px){  .grid{ grid-template-columns:repeat(2,1fr) } }
  @media (max-width:360px){  .grid{ grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px } }

  .card{ background:var(--card-bg); border:2px solid #e9e9e9; border-radius:8px; box-shadow:var(--shadow); overflow:hidden }
  .frame{ background:#f8f7f5; padding:10px 10px 0 10px; border-bottom:2px solid #e5e5e5 }
  .photo{ width:100%; aspect-ratio:1/1; object-fit:cover; border:1px solid #cfd3d6; border-radius:4px; background:linear-gradient(#dff0ff,#bfe3ff) }

  /* barra inferior do card: preço em cima, botão embaixo */
  .bar{ display:flex; flex-direction:column; align-items:center; gap:8px; padding:10px 14px 14px 14px; background:#f3f2ef }
  .price{ font-weight:800; font-size:clamp(16px,3.4vw,22px); color:#000 }

  /* Botão WhatsApp compacto e estável */
  .wa-btn{
    display:inline-flex; align-items:center; gap:6px;
    background:#fff; border:1px solid #d9d9d9; border-radius:999px;
    padding:8px 14px; font-size:14px; line-height:1;
    cursor:pointer; text-decoration:none; color:#0b0b0b; box-shadow:var(--shadow);
    white-space:nowrap; max-width:100%;
  }
  .wa-icon{ width:22px; height:22px; border-radius:50%; background:var(--whats); display:grid; place-items:center; flex-shrink:0 }
  .wa-icon svg{ width:14px; height:14px; fill:#fff }

  .foot{ text-align:center; margin:28px 0 6px; color:#666; font-size:14px }
  .empty{ text-align:center; opacity:.75; padding:40px 10px }
</style>
</head>
<body>

<div id="app" class="wrap">
  <!-- Header dinâmico -->
  <header class="hero">
    <img id="logo" class="logo" src="" alt="Logo da Empresa">
    <h1 id="storeName" class="title">Nome da Empresa</h1>
  </header>

  <!-- Grid dinâmico -->
  <section id="grid" class="grid"></section>

  <p class="foot">© 2025 MostreAki</p>
</div>

<script>
/* ====== 1) Helpers ====== */
const fmtBRL = (v) => {
  // aceita centavos (number) ou string "R$ 12,00"
  if (typeof v === 'number') return (v/100).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  if (typeof v === 'string') {
    const num = Number(String(v).replace(/[^\d]/g,''));
    if (!isNaN(num) && num>0) return (num/100).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    return v; // se veio "Preço", mantém
  }
  return 'R$ 0,00';
};
const onlyDigits = s => (s||'').toString().replace(/\D/g,'');
const el = (tag, attrs={}, children=[])=>{
  const n = document.createElement(tag);
  for (const [k,v] of Object.entries(attrs)) {
    if (k === 'class') n.className = v;
    else if (k === 'html') n.innerHTML = v;
    else if (k.startsWith('on') && typeof v === 'function') n.addEventListener(k.slice(2), v);
    else n.setAttribute(k, v);
  }
  (Array.isArray(children) ? children : [children]).filter(Boolean).forEach(c=> n.append(c));
  return n;
};
const waIcon = () => el('span', {class:'wa-icon', 'aria-hidden':'true', html:
  `<svg viewBox="0 0 24 24"><path d="M17.5 14.4c-.3-.2-1.8-.9-2.1-1-.3-.1-.5-.2-.7.2-.2.3-.8 1-.9 1.1-.2.1-.3.2-.6 0-.3-.2-1.2-.5-2.2-1.5-.8-.7-1.3-1.6-1.5-1.9-.2-.3 0-.4.2-.6.2-.2.3-.3.5-.5.2-.2.2-.3.3-.5.1-.2 0-.4 0-.5 0-.2-.7-1.8-1-2.5-.2-.6-.5-.5-.7-.5h-.6c-.2 0-.5.1-.8.4-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.8 4.4 1.8.8 2.5.9 3.4.8.5 0 1.7-.7 2-1.3.2-.6.2-1.2.1-1.3zM12 2a10 10 0 1 1 0 20 9.9 9.9 0 0 1-4.9-1.3L2 22l1.3-5.1A9.9 9.9 0 0 1 12 2z"/></svg>`
});

/* ====== 2) Entrada de dados ====== */
/* Ordem de busca:
   A) window.CATALOGO
   B) ?data= (base64 do JSON)
   C) localStorage["mostreaki.catalog"]
*/
function loadCatalog() {
  if (window.CATALOGO) return window.CATALOGO;

  const q = new URLSearchParams(location.search);
  const b64 = q.get('data');
  if (b64) {
    try {
      const json = atob(b64);
      const obj = JSON.parse(json);
      return obj;
    } catch (e) { console.warn('data inválido'); }
  }

  try {
    const raw = localStorage.getItem('mostreaki.catalog');
    if (raw) return JSON.parse(raw);
  } catch (e) {}

  // fallback de demonstração
  return {
    storeName: "Nome da Empresa",
    whatsapp: "5599999999999",
    logo: "https://via.placeholder.com/512x512.png?text=LOGO",
    items: [
      { name:"Pão com Salsicha",      price:1200, img:"https://picsum.photos/seed/a/900/900" },
      { name:"X-Duplo",               price:2400, img:"https://picsum.photos/seed/b/900/900" },
      { name:"Batata com Cheddar",    price:1800, img:"https://picsum.photos/seed/c/900/900" },
      { name:"Refrigerante",          price: 700, img:"https://picsum.photos/seed/d/900/900" }
    ]
  };
}

/* ====== 3) Render ====== */
function render(catalog) {
  // header
  document.getElementById('storeName').textContent = catalog.storeName || 'Minha Loja';
  const logoEl = document.getElementById('logo');
  logoEl.src = catalog.logo || 'https://via.placeholder.com/512x512.png?text=LOGO';
  logoEl.alt = `Logo de ${catalog.storeName || 'Minha Loja'}`;

  // grid
  const grid = document.getElementById('grid');
  grid.innerHTML = '';

  const phone = onlyDigits(catalog.whatsapp || '');
  const items = Array.isArray(catalog.items) ? catalog.items : [];

  if (!items.length) {
    grid.append( el('div', {class:'empty', html:'Sem itens por aqui ainda.'}) );
    return;
  }

  for (const it of items) {
    const priceText = fmtBRL(it.price ?? it.preco ?? it.valor ?? 'R$ 0,00');
    const img = it.img || it.imageUrl || it.foto || '';
    const name = it.name || it.nome || 'Produto';

    const card = el('article', {class:'card', 'data-item':name, 'data-price':priceText});
    const frame = el('div', {class:'frame'});
    const photo = el('img', {class:'photo', src: img, alt: name, loading:'lazy', decoding:'async'});
    frame.append(photo);

    const bar = el('div', {class:'bar'});
    const price = el('div', {class:'price'}, priceText);

    const btn = el('a', {class:'wa-btn', href:'#'});
    btn.append( waIcon(), document.createTextNode('WhatsApp') );
    btn.onclick = (e)=>{
      e.preventDefault();
      if (!phone) return;
      const msg = encodeURIComponent(`Olá! Tenho interesse em ${name} (${priceText}).`);
      const url = `https://wa.me/${phone}?text=${msg}`;
      window.open(url, '_blank', 'noopener');
    };

    bar.append(price, btn);
    card.append(frame, bar);
    grid.append(card);
  }
}

/* ====== 4) Boot ====== */
const C = loadCatalog();
render(C);

/* ====== 5) (Opcional) Expor helpers para seu editor “Salvar & Visualizar” ====== */
/* Gere link público assim:
   const data = btoa(JSON.stringify(catalog));
   const url  = location.origin + '/catalogo-template.html?data=' + data;
*/
window.MostreAki = {
  render,
  setCatalog(c){ try{ localStorage.setItem('mostreaki.catalog', JSON.stringify(c)); render(c); }catch(e){} },
  getShareURL(){
    try{
      const raw = localStorage.getItem('mostreaki.catalog');
      const obj = raw ? JSON.parse(raw) : C;
      const data = btoa(decodeURIComponent(encodeURIComponent(JSON.stringify(obj))));
      return location.origin + location.pathname + '?data=' + data;
    }catch(e){ return location.href; }
  }
};
</script>
</body>
</html>
