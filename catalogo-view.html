<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Catálogo | MostreAki</title>
<style>
  :root{--bg:#0b0c10;--panel:#111318;--ink:#eaf0f6;--brand:#26c281;--brand-ink:#002b1a;--radius:16px}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:#0b0c10}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
  .logo{width:56px;height:56px;border-radius:50%;overflow:hidden;background:#0e0}
  .logo img{width:100%;height:100%;object-fit:cover}
  h1{margin:0;font-size:clamp(20px,2.6vw,30px)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
  @media (min-width:520px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media (min-width:960px){.grid{grid-template-columns:repeat(4,1fr)}}
  .card{background:var(--panel);border:1px solid #1a1f27;border-radius:var(--radius);overflow:hidden}
  .media{aspect-ratio:1/1;background:#12161f}
  .media img{width:100%;height:100%;object-fit:cover}
  .body{padding:12px;display:grid;gap:8px}
  .title{font-weight:800}
  .price{opacity:.9}
  .wapp{background:var(--brand);color:var(--brand-ink);border:0;padding:10px 12px;border-radius:12px;font-weight:800;cursor:pointer;width:100%}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><img id="logo" alt="Logo"/></div>
    <h1 id="store">Catálogo</h1>
  </header>
  <section id="grid" class="grid"></section>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBrkUtwP4T77oXE22OjOFVhfEUlJ7yctiE",
    authDomain: "mostreaki-2025.firebaseapp.com",
    projectId: "mostreaki-2025",
    storageBucket: "mostreaki-2025.appspot.com",
    appId: "1:748712068097:web:09cf043bfb45917ef6ec00",
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const fmtBRL = new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'});
  const id = new URLSearchParams(location.search).get('id');

  async function load(){
    if(!id){ document.body.innerHTML='<p style="padding:20px">Catálogo não encontrado.</p>'; return; }
    const snap = await getDoc(doc(db,'catalogos', id));
    if(!snap.exists()){ document.body.innerHTML='<p style="padding:20px">Catálogo inexistente.</p>'; return; }
    const data = snap.data();
    // tema
    const root = document.documentElement, t=data.theme||{};
    root.style.setProperty('--bg', t.bg || '#0b0c10');
    root.style.setProperty('--panel', t.box|| '#111318');
    root.style.setProperty('--ink', t.text|| '#eaf0f6');
    root.style.setProperty('--brand', t.btn|| '#26c281');
    document.body.style.background = (/^#|^rgb|^hsl/i.test(t.bg||'')) ? (t.bg||'#0b0c10') : `url(${t.bg}) center/cover no-repeat`;
    // topo
    if(data.logoUrl) document.getElementById('logo').src = data.logoUrl;
    document.getElementById('store').textContent = data.store || 'Catálogo';
    // itens
    const grid = document.getElementById('grid');
    (data.items||[]).forEach(i=>{
      const card = document.createElement('article'); card.className='card';
      card.innerHTML = `
        <div class="media">${i.image_url?`<img src="${i.image_url}" alt="">`:''}</div>
        <div class="body">
          <div class="title">${i.name||'Produto'}</div>
          <div class="price">${fmtBRL.format((i.price_cents||0)/100)}</div>
          <button class="wapp">Chamar no WhatsApp</button>
        </div>`;
      card.querySelector('.wapp').onclick=()=>{
        const msg = `Olá, vim do catálogo *${encodeURIComponent(data.store||'Minha Loja')}*%0AProduto: *${encodeURIComponent(i.name||'Produto')}*%0APreço: *${encodeURIComponent(fmtBRL.format((i.price_cents||0)/100))}*`;
        window.open(`https://wa.me/${(data.whatsapp||'').replace(/\D/g,'')}?text=${msg}`,'_blank');
      };
      grid.appendChild(card);
    });
  }
  load();
</script>
</body>
</html>
