<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Upload de Arquivo – MostreAki</title>
<style>
  body{font-family:Arial;text-align:center;padding-top:40px;background:#f7f7f7}
  input,button{padding:10px;font-size:16px;margin:8px}
  #link{margin-top:20px;word-break:break-all}
</style>
</head>
<body>

<h1>Upload de Arquivo no Firebase Storage</h1>

<input id="file" type="file" accept="image/*">
<button id="btn">Enviar</button>

<div id="status"></div>
<div id="link"></div>

<!-- SDKs -->
<script type="module">
import { initializeApp }          from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

/* ---------- CONFIG DO SEU PROJETO ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyBrKUtwP4T77oXE22cjOFVhfEUiJ7yctIE",
  authDomain: "mostreaki-2025.firebaseapp.com",
  projectId:  "mostreaki-2025",
  storageBucket: "mostreaki-2025.appspot.com",
  messagingSenderId: "748712068097",
  appId: "1:748712068097:web:09cf043fbb45917ef6ec00"
};

/* ---------- INIT ---------- */
initializeApp(firebaseConfig);
const auth    = getAuth();
const storage = getStorage();

/* ---------- LOGIN ANÔNIMO ---------- */
async function loginAnon() {
  try { await signInAnonymously(auth); }
  catch (e) { alert("Erro ao autenticar: " + e); throw e; }
}

/* ---------- UPLOAD ---------- */
async function enviarArquivo() {
  const file = document.getElementById('file').files[0];
  if (!file) { alert("Escolha um arquivo primeiro"); return; }

  document.getElementById('status').textContent = "⌛ Enviando…";

  try {
    await loginAnon();                         // garante que estamos autenticados
    const caminho = `testes/${Date.now()}_${file.name}`;
    const arquivoRef = ref(storage, caminho);

    const snap = await uploadBytes(arquivoRef, file);
    if (!snap) throw new Error("Falha no upload");

    const url = await getDownloadURL(arquivoRef);

    document.getElementById('status').textContent = "✅ Upload concluído!";
    document.getElementById('link').innerHTML =
      `URL pública:<br><a href="${url}" target="_blank">${url}</a>`;
  } catch (err) {
    console.error(err);
    document.getElementById('status').textContent = "❌ Erro: " + err.message;
  }
}

/* ---------- EVENTO DO BOTÃO ---------- */
document.getElementById('btn').onclick = enviarArquivo;
</script>
</body>
</html>
