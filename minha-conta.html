<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minha Conta - MostreAki</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; position: relative; }
    #loader { position: fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:1.2rem; }
    #pageContainer { visibility: hidden; }
    header { background: #c2e7df; height:60px; display:flex; align-items:center; justify-content:space-between; padding:0 20px; box-shadow:0 2px 4px rgba(0,0,0,0.1); position:relative; }
    .logo-container img { height:40px; margin-right:10px; }
    .logo .mostre { color:#00C2BF; } .logo .aki { color:#FA1E39; }
    .menu-list { display:none; position:absolute; top:60px; right:20px; background:#16807C; border:2px solid black; border-radius:6px; padding:10px; flex-direction:column; z-index:1000; }
    .menu-list a { text-decoration:none; color:white; padding:10px 15px; background:#FA1E39; border-radius:6px; margin-bottom:8px; font-weight:bold; text-align:center; }
    .user-circle { width:32px; height:32px; border-radius:50%; background:#15b0af; overflow:hidden; display:flex; align-items:center; justify-content:center; font-size:.8rem; position:relative; }
    .user-circle img { position:absolute; width:100%; height:100%; object-fit:cover; border-radius:50%; }
    .container { background:white; max-width:600px; margin:auto; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    /* => form e botões... (igual ao que você já tem) */
  </style>
</head>
<body>

  <div id="loader">Carregando seus dados…</div>
  <div id="pageContainer">
    <header>  
      <div class="logo-container"><img src="logo.png" alt="Logo"/><div class="logo"><span class="mostre">Mostre</span><span class="aki">Aki</span></div></div>
      <div style="display:flex; align-items:center; gap:10px;">
        <span id="authText" style="font-weight:bold;color:#15b0af;cursor:pointer;" onclick="logout()">Sair</span>
        <div id="userCircle" class="user-circle" title="Perfil"></div>
        <div class="menu-icon" onclick="toggleMenu()">☰</div>
      </div>
      <div class="menu-list" id="menu">
        <a href="/index.html">Página Inicial</a><a href="/sobre.html">Sobre</a><a href="/minhaconta.html">Minha Conta</a>
        <a href="/planos.html">Planos</a><a href="/servicos-adicionais.html">Serviços Adicionais</a>
        <a href="/crieaki.html">CrieAki</a><a href="/contatos.html">Contatos</a>
      </div>
    </header>
    <div class="container">
      <!-- aqui vai seu form com foto, instagram, etc -->
      <div class="form-group">
        <label for="foto">Foto de Perfil</label>
        <input type="file" id="foto" accept="image/*" onchange="previewImagem(event)">
        <img id="fotoPreview" src="" alt="Preview" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin:10px auto;display:block;border:2px solid #ccc;">
      </div>
      <!-- demais campos... -->
      <button class="btn btn-salvar" onclick="salvarDados()">Salvar Alterações</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "...", authDomain: "mostreaki-2025.firebaseapp.com",
      projectId: "mostreaki-2025", storageBucket: "...",
      messagingSenderId: "...", appId: "..."
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async user => {
      document.getElementById("loader").style.display = "none";
      const page = document.getElementById("pageContainer");
      if (!user) return location.href = "/index.html";
      page.style.visibility = "visible";
      // popula campos
      const udata = (await getDoc(doc(db, "usuarios", user.uid))).data() || {};
      document.getElementById("instagram").value = udata.instagram || "";
      // repetir para facebook, whatsapp, youtube...
      if (udata.fotoPerfil) {
        document.getElementById("fotoPreview").src = udata.fotoPerfil;
        atualizarUserCircle(udata.fotoPerfil);
      } else atualizarUserCircle();
    });

    window.salvarDados = async () => {
      const user = auth.currentUser;
      if (!user) return alert("Não autenticado");
      const data = {
        instagram: document.getElementById("instagram").value,
        // facebook, whatsapp, youtube...
        fotoPerfil: document.getElementById("fotoPreview").src
      };
      await setDoc(doc(db, "usuarios", user.uid), data);
      alert("Salvo com sucesso!");
      atualizarUserCircle(data.fotoPerfil);
    };

    window.previewImagem = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        document.getElementById("fotoPreview").src = reader.result;
      };
      reader.readAsDataURL(file);
    };

    window.atualizarUserCircle = (url = null) => {
      const c = document.getElementById("userCircle");
      c.innerHTML = "";
      const img = document.createElement("img");
      img.src = url || "";
      c.appendChild(img);
    };

    window.logout = () => signOut(auth).then(() => location.href = "/index.html");

    window.toggleMenu = () => document.getElementById("menu").style.display =
      document.getElementById("menu").style.display === "flex" ? "none" : "flex";
  </script>
</body>
</html>
