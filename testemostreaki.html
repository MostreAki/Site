<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Teste de Upload no Firebase Storage</title>
</head>
<body>
  <h2>Teste de Upload no Firebase Storage</h2>
  <input type="file" id="fileInput" />
  <button onclick="uploadFile()">Upload</button>
  <p id="status"></p>
  <img id="preview" style="max-width:200px; display:none;" />

  <!-- Firebase SDK -->
  <script type="module">
    // SDKs do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    // Config do seu projeto Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "mostreaki-2025.firebaseapp.com",
      projectId: "mostreaki-2025",
      storageBucket: "mostreaki-2025.appspot.com",
      messagingSenderId: "SEU_MESSAGING_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);
    let currentUserUID = null;

    signInAnonymously(auth)
      .then(() => {
        document.getElementById("status").innerText = "Login anônimo OK!";
      })
      .catch((error) => {
        alert("Erro no login anônimo: " + error.message);
      });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUserUID = user.uid;
      }
    });

    window.uploadFile = async () => {
      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        alert("Selecione um arquivo!");
        return;
      }

      const filePath = `testeUploads/${currentUserUID}/${file.name}`;
      const fileRef = ref(storage, filePath);

      try {
        await uploadBytes(fileRef, file);
        const url = await getDownloadURL(fileRef);
        document.getElementById("status").innerText = "Upload feito com sucesso!";
        const img = document.getElementById("preview");
        img.src = url;
        img.style.display = "block";
      } catch (error) {
        document.getElementById("status").innerText = "Erro no upload: " + error.message;
      }
    };
  </script>
</body>
</html>
