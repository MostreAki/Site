<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>La Maggiê — Artesanato</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-desktop: url('bg-desktop.jpg');
      --bg-mobile:  url('bg-mobile.jpg');

      --cream:#F8F1EB;
      --rose:#D98C93;
      --rose-600:#C66E77;
      --rose-700:#B05963;
      --ink:#5C3E42;
      --muted:#87636A;
      --shadow:0 14px 36px rgba(92,62,66,.18);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Nunito", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--ink);
      background-image: var(--bg-desktop);
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    @media (max-width: 640px){
      body{ background-image: var(--bg-mobile); background-attachment: scroll; }
    }

    .overlay{
      position: fixed; inset:0;
      background:
        radial-gradient(60% 40% at 10% 0%, rgba(248,241,235,.55) 0%, rgba(248,241,235,.05) 60%),
        linear-gradient(180deg, rgba(248,241,235,.28), rgba(248,241,235,.65));
      pointer-events:none;
    }

    .wrap{ max-width: 920px; margin: 0 auto; padding: 28px 20px 90px; }

    /* HERO */
    .hero{ text-align:center; margin: 14px auto 28px; }
    .logo{
      width: 140px; height: 140px; margin: 0 auto 12px;
      border-radius: 50%; overflow: hidden;
      background: rgba(255,255,255,.65);
      backdrop-filter: blur(3px);
      border: 2px solid rgba(92,62,66,.15);
      box-shadow: inset 0 6px 18px rgba(217,140,147,.15), 0 4px 10px rgba(92,62,66,.18);
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }

    .quick-icons{ display:flex; justify-content:center; gap:16px; margin: 6px 0 6px; }
    .qi{ width:36px; height:36px; display:grid; place-items:center; border-radius:50%;
        background: rgba(255,255,255,.85); border:1px solid rgba(92,62,66,.15);
        box-shadow: 0 4px 10px rgba(92,62,66,.12); color: var(--rose-700);
        text-decoration:none; transition: transform .12s ease, box-shadow .12s ease; }
    .qi:hover{ transform: translateY(-2px); box-shadow: 0 8px 18px rgba(92,62,66,.18); }
    .qi svg{ width:20px; height:20px; display:block; }

    h1{ font-family:"Fraunces", ui-serif, Georgia, serif; font-weight:700;
        font-size: clamp(28px, 6vw, 48px); margin: 6px 0 4px; letter-spacing:.2px;
        text-shadow: 0 1px 0 rgba(255,255,255,.5); }
    .tagline{ margin:0 0 8px; font-weight:700; letter-spacing:.24px; color:var(--rose-700);
        text-shadow: 0 1px 0 rgba(255,255,255,.6); }
    .bio{ margin: 8px auto 0; max-width: 60ch; font-size: 16px; line-height: 1.6;
        color: var(--ink); text-shadow: 0 1px 0 rgba(255,255,255,.65); }

    /* ====== CARD CATÁLOGO ====== */
    .catalog-card{
      width:100%; max-width: 720px; margin: 22px auto 0;
      background:#fff; border-radius: var(--radius);
      border: 1px solid rgba(92,62,66,.12); box-shadow: var(--shadow);
      padding: 16px;
    }
    .catalog-title{
      font-family:"Fraunces", ui-serif, Georgia, serif;
      font-size: 20px; margin: 0 0 10px; letter-spacing:.2px; color: var(--ink);
    }
    .catalog-cover{ position: relative; border-radius: 14px; overflow: hidden;
      border:1px solid rgba(92,62,66,.12); aspect-ratio: 16/9; background:#eee; }
    .catalog-cover img{ width:100%; height:100%; object-fit: cover; display:block; transition: transform .25s ease; }
    .catalog-link{ display:block; text-decoration:none; }
    .catalog-link:hover img{ transform: scale(1.02); }
    .catalog-badge{ position:absolute; right:10px; bottom:10px; background: rgba(255,255,255,.92); color: var(--rose-700);
      border:1px solid rgba(92,62,66,.16); border-radius: 999px; padding: 6px 10px; font-weight:700; font-size: 13px;
      box-shadow: 0 6px 16px rgba(92,62,66,.18); }

    /* ====== CARD SHORTS ====== */
    .shorts-card{
      width:100%; max-width: 720px; margin: 22px auto 0;
      background:#fff; border-radius: var(--radius);
      border:  1px solid rgba(92,62,66,.12); box-shadow: var(--shadow);
      padding: 18px 18px 16px;
    }
    .shorts-header{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom: 12px; }
    .shorts-title{ font-family:"Fraunces", ui-serif, Georgia, serif; font-size: 20px; margin:0; letter-spacing:.2px; color: var(--ink); }
    .shorts-more{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; text-decoration:none; font-weight:700; color:var(--rose-700);
      background: linear-gradient(180deg, rgba(217,140,147,.18), rgba(217,140,147,.08)); border:1px solid rgba(176,89,99,.22); }
    .shorts-grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    @media (max-width:640px){ .shorts-grid{ grid-template-columns: repeat(3, 1fr); } }
    .short{ position:relative; aspect-ratio: 9/16; border-radius:14px; overflow:hidden; background:#eee; border:1px solid rgba(92,62,66,.12); }
    .short img{ width:100%; height:100%; object-fit:cover; display:block; transition: transform .25s ease; }
    .short:hover img{ transform: scale(1.03); }
    .play{ position:absolute; inset:auto 8px 8px auto; width:34px; height:34px; border-radius:50%; display:grid; place-items:center;
      background: rgba(255,255,255,.9); border:1px solid rgba(92,62,66,.15); color: var(--rose-700); box-shadow: 0 4px 10px rgba(92,62,66,.15); }

    /* ====== CARD REDES ====== */
    .card{ width:100%; max-width: 560px; margin: 22px auto 0; background: rgba(255,255,255,.92);
      backdrop-filter: blur(6px); border-radius: var(--radius); border: 1px solid rgba(92,62,66,.16);
      box-shadow: var(--shadow); padding: 20px; }
    .links{ display:flex; flex-direction:column; gap:12px; }
    .btn{ display:flex; align-items:center; gap:12px; padding: 14px 16px; border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.25)) padding-box,
                 linear-gradient(180deg, rgba(217,140,147,.35), rgba(217,140,147,.18)) border-box;
      border: 1.5px solid transparent; color: var(--ink); text-decoration:none; font-weight:700;
      box-shadow: 0 8px 20px rgba(92,62,66,.10); transition: transform .12s ease, box-shadow .12s ease; }
    .btn:hover{ transform: translateY(-2px); box-shadow: 0 12px 26px rgba(92,62,66,.18); }
    .icon,.go{ width:22px; height:22px; display:grid; place-items:center; color:var(--rose-700); }
    .go{ color:var(--rose-600); }
    .text{ flex:1 }

    /* ====== CARD AVALIAÇÕES ====== */
    .reviews-card{
      width:100%; max-width:720px; margin:22px auto 0;
      background:#fff; border-radius: var(--radius);
      border:1px solid rgba(92,62,66,.12); box-shadow: var(--shadow);
      padding:18px;
    }
    .reviews-title{
      font-family:"Fraunces", ui-serif, Georgia, serif;
      font-size:20px; margin:0 0 12px; letter-spacing:.2px; color:var(--ink);
    }
    .reviews{
      display:grid; grid-template-columns:repeat(3,1fr); gap:12px;
    }
    @media (max-width:720px){ .reviews{ grid-template-columns:1fr; } }
    .review{
      border:1px solid rgba(92,62,66,.12); border-radius:14px; padding:12px; background:#fff;
    }
    .rev-head{ display:flex; align-items:center; gap:10px; margin-bottom:6px; }
    .avatar{
      width:36px; height:36px; border-radius:50%; display:grid; place-items:center;
      background:rgba(217,140,147,.12); color:var(--rose-700); font-weight:800; border:1px solid rgba(92,62,66,.12);
    }
    .name{ font-weight:800; }
    .stars{ color:#E6A400; font-size:14px; letter-spacing:1px; }
    .rev-text{ color:var(--muted); margin:6px 0 0; font-size:14.5px; line-height:1.45; }

    footer{
      text-align:center;
      color:#000;
      font-size:13px;
      margin-top: 28px;
      text-shadow:none;
    }

    /* Banner de diagnóstico (aparece só em erro) */
    .diag{position:fixed;left:12px;right:12px;bottom:12px;background:#fff3cd;color:#664d03;border:1px solid #ffecb5;border-radius:12px;padding:12px;box-shadow:0 8px 24px rgba(0,0,0,.15);z-index:9999;font:14px/1.4 system-ui;display:none}
    .diag.show{display:block}
  </style>
</head>
<body>
  <div class="overlay" aria-hidden="true"></div>

  <main class="wrap">
    <!-- HERO -->
    <section class="hero" aria-label="Apresentação">
      <div class="logo">
        <img id="logo-img" src="logo-lamaggie.png" alt="Logotipo">
      </div>

      <!-- Ícones rápidos -->
      <nav class="quick-icons" aria-label="Atalhos rápidos">
        <a class="qi" id="qi-instagram" href="#" target="_blank" rel="noopener" aria-label="Instagram">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="3" width="18" height="18" rx="5" /><circle cx="12" cy="12" r="3.8" /><circle cx="17.2" cy="6.8" r="1.1" fill="currentColor" stroke="none"/></svg>
        </a>
        <a class="qi" id="qi-whatsapp" href="#" target="_blank" rel="noopener" aria-label="WhatsApp">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M20.5 12a8.5 8.5 0 1 1-3.3-6.7" /><path d="M5.2 18.8 4 22l3.4-1.2" /><path d="M8.8 8.8c-.3.9.6 2.1 2 3.4s2.6 1.9 3.5 1.6c.4-.1.9-.7 1.2-1.1.1-.2.4-.2.6 0l.7 1.2c.2.3.1.7-.1 1-1.3 1.6-3.2 2.1-5.2 1.5-2-.6-4.1-2.4-5.3-4.4-1.2-2-1.5-3.8-.9-5.2.2-.4.6-.6 1-.5l1.3.4c.3.1.4.4.3.7-.3.5-.7 1-.9 1.4Z" fill="currentColor" stroke="none"/></svg>
        </a>
        <a class="qi" id="qi-youtube" href="#" target="_blank" rel="noopener" aria-label="YouTube">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="6" width="18" height="12" rx="3.5"/><path d="M11 9v6l5-3-5-3z" fill="currentColor" stroke="none"/></svg>
        </a>
      </nav>

      <h1 id="site-title">La Maggiê</h1>
      <p class="tagline" id="site-tagline">Artesanato</p>
      <p class="bio" id="site-bio">Bem-vindos ao Portal.</p>
    </section>

    <!-- Card Catálogo -->
    <section class="catalog-card" aria-label="Catálogo">
      <h2 class="catalog-title">Catálogo</h2>
      <a class="catalog-link" id="catalog-link" href="catalogo-lamaggie.html" aria-label="Abrir catálogo">
        <div class="catalog-cover">
          <img id="catalog-cover" src="catalogo-capa.jpg" alt="Imagem de capa do catálogo">
          <span class="catalog-badge">Abrir catálogo ➜</span>
        </div>
      </a>
    </section>

    <!-- Card Shorts -->
    <section class="shorts-card" aria-label="Vídeos de Artesanato">
      <div class="shorts-header">
        <h2 class="shorts-title">Vídeos de Artesanato</h2>
        <a class="shorts-more" id="shorts-more" href="videos.html" aria-label="Ver todos os shorts">Ver todos</a>
      </div>
      <div class="shorts-grid" id="shorts-grid">
        <!-- Fallback (substituído quando Firestore tiver dados) -->
        <a class="short" href="videos.html" aria-label="Abrir página de shorts">
          <img src="https://img.youtube.com/vi/VIDEO_ID_1/hqdefault.jpg" alt="Short 1">
          <span class="play" aria-hidden="true">▶</span>
        </a>
        <a class="short" href="videos.html" aria-label="Abrir página de shorts">
          <img src="https://img.youtube.com/vi/VIDEO_ID_2/hqdefault.jpg" alt="Short 2">
          <span class="play" aria-hidden="true">▶</span>
        </a>
        <a class="short" href="videos.html" aria-label="Abrir página de shorts">
          <img src="https://img.youtube.com/vi/VIDEO_ID_3/hqdefault.jpg" alt="Short 3">
          <span class="play" aria-hidden="true">▶</span>
        </a>
      </div>
    </section>

    <!-- Redes -->
    <section class="card" aria-label="Redes oficiais">
      <nav class="links">
        <a class="btn" id="btn-instagram" href="#" target="_blank" rel="noopener">
          <span class="icon" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Z" stroke="currentColor" stroke-width="1.6"/><circle cx="12" cy="12" r="3.5" stroke="currentColor" stroke-width="1.6"/><circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"/></svg>
          </span>
          <span class="text">Instagram</span>
          <span class="go" aria-hidden="true">➜</span>
        </a>

        <a class="btn" id="btn-whatsapp" href="#" target="_blank" rel="noopener">
          <span class="icon" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M20.5 13.5a8.5 8.5 0 1 1-3.2-6.6l.2.1" stroke="currentColor" stroke-width="1.6"/><path d="M5.5 18.5l-1 3.5 3.6-1A8.5 8.5 0 0 0 21 10.1" stroke="currentColor" stroke-width="1.6"/><path d="M9.8 8.9c-.2.8.5 2 2 3.3s2.5 1.7 3.3 1.5c.3-.1.8-.6 1.1-1l.2-.2c.2-.2.5-.1.6.1l.6 1.1c.2.3.1.7-.1 1-1.1 1.4-2.8 1.9-4.7 1.3-1.9-.6-3.9-2.3-5-4.1-1.2-1.8-1.4-3.6-.8-4.9.2-.4.6-.6 1-.5l1.2.4c.3.1.4.4.3.7l-.2.3c-.3.5-.7.9-.8 1z" fill="currentColor"/></svg>
          </span>
          <span class="text">WhatsApp</span>
          <span class="go" aria-hidden="true">➜</span>
        </a>

        <a class="btn" id="btn-youtube" href="#" target="_blank" rel="noopener">
          <span class="icon" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><rect x="2.5" y="5.5" width="19" height="13" rx="3.5" stroke="currentColor" stroke-width="1.6"/><path d="M11 9v6l5-3-5-3z" fill="currentColor"/></svg>
          </span>
          <span class="text">YouTube</span>
          <span class="go" aria-hidden="true">➜</span>
        </a>
      </nav>
    </section>

    <!-- Avaliações -->
    <section class="reviews-card" aria-label="Avaliações de clientes">
      <h2 class="reviews-title">Avaliações dos clientes</h2>
      <div class="reviews" id="reviews">
        <!-- Fallback estático (substituído quando Firestore tiver dados) -->
        <div class="review">
          <div class="rev-head">
            <div class="avatar">AM</div>
            <div>
              <div class="name">Cliente A</div>
              <div class="stars">★★★★★</div>
            </div>
          </div>
          <p class="rev-text">Exemplo de avaliação.</p>
        </div>
      </div>
    </section>

    <footer>©2025 Todos os direitos reservados</footer>
  </main>

  <div id="diag" class="diag"></div>

  <!-- Firebase + Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 🔑 Config do projeto MOSTREAKI-2025 (as chaves que você me passou)
    const firebaseConfig = {
      apiKey: "AIzaSyBrKUtwP4T77oXE22cjOFVhfEUiJ7yctIE",
      authDomain: "mostreaki-2025.firebaseapp.com",
      projectId: "mostreaki-2025",
      storageBucket: "mostreaki-2025.firebasestorage.app",
      messagingSenderId: "748712068097",
      appId: "1:748712068097:web:09cf043fbb45917ef6ec00"
    };

    /* ========= Helpers ========= */
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const $      = s => document.querySelector(s);
    const setIf  = (el, attr, val) => { if(el && val) el.setAttribute(attr, val); };
    const textIf = (el, val) => { if(el && val) el.textContent = val; };
    const showDiag = (msg) => { const d=$("#diag"); if(!d) return; d.textContent=msg; d.classList.add("show"); };

    // Descobre o "usuario" pela query ?usuario=lamaggie (fallback = lamaggie)
    const url    = new URL(location.href);
    const USUARIO = url.searchParams.get("usuario") || "lamaggie";

    // Caminhos: pages/home (prioridade), depois site raiz como fallback
    async function getData(pathArray){
      try{
        const snap = await getDoc(doc(db, ...pathArray));
        return snap.exists() ? snap.data() : null;
      }catch(e){
        console.warn("Firestore read error:", pathArray.join("/"), e);
        showDiag("Falha ao ler " + pathArray.join("/") + " — ver console.");
        return null;
      }
    }

    function applyLogo(url){
      if(!url) return;
      const img = $("#logo-img");
      if(img) img.src = url;
    }

    function applyBackground(bg, assetsBase){
      const desk = bg?.desktop, mob = bg?.mobile;
      if(desk) document.documentElement.style.setProperty("--bg-desktop", `url('${assetsBase? assetsBase+desk : desk}')`);
      if(mob)  document.documentElement.style.setProperty("--bg-mobile",  `url('${assetsBase? assetsBase+mob  : mob }')`);
    }

    function applySocial(social){
      if(!social) return;
      setIf($("#qi-instagram"), "href", social.instagram);
      setIf($("#btn-instagram"),"href", social.instagram);
      setIf($("#qi-whatsapp"), "href", social.whatsapp);
      setIf($("#btn-whatsapp"),"href", social.whatsapp);
      setIf($("#qi-youtube"),  "href", social.youtube);
      setIf($("#btn-youtube"), "href", social.youtube);
    }

    function applyRoutes(routes){
      // catálogo
      let catalogHref = "catalogo.html";
      if(Array.isArray(routes)){
        const cat = routes.find(r => r.path === "/catalogo");
        if(cat){
          catalogHref = (cat.type === "external" && cat.url) ? cat.url : cat.path;
        }
        const vids = routes.find(r => r.path === "/videos");
        if(vids) setIf($("#shorts-more"), "href", vids.url || vids.path || "videos.html");
      }
      setIf($("#catalog-link"), "href", catalogHref);
    }

    function applyShorts(ids){
      if(!Array.isArray(ids) || !ids.length) return;
      const grid = $("#shorts-grid");
      if(!grid) return;
      grid.innerHTML = ids.slice(0,3).map(id => `
        <a class="short" href="https://www.youtube.com/shorts/${id}" target="_blank" rel="noopener" aria-label="Assistir short">
          <img src="https://img.youtube.com/vi/${id}/hqdefault.jpg" alt="Short ${id}">
          <span class="play" aria-hidden="true">▶</span>
        </a>
      `).join("");
    }

    function applyReviews(reviews){
      if(!Array.isArray(reviews) || !reviews.length) return;
      const box = $("#reviews");
      if(!box) return;
      box.innerHTML = reviews.slice(0,3).map(r => {
        const stars = Math.max(0, Math.min(5, r.stars || 5));
        const initials = (r.initials || (r.name||"").split(" ").map(p=>p[0]).slice(0,2).join("") || "CL").toUpperCase();
        return `
          <div class="review">
            <div class="rev-head">
              <div class="avatar">${initials}</div>
              <div>
                <div class="name">${r.name || "Cliente"}</div>
                <div class="stars">${"★★★★★".slice(0,stars)}${stars<5?"☆☆☆☆☆".slice(0,5-stars):""}</div>
              </div>
            </div>
            <p class="rev-text">${r.text || ""}</p>
          </div>
        `;
      }).join("");
    }

    (async function boot(){
      // 1) Lê página: sites/{usuario}/pages/home  (PRIORIDADE)
      const page = await getData(["sites", USUARIO, "pages", "home"]);
      if(!page){
        showDiag(`Documento "sites/${USUARIO}/pages/home" não encontrado (usando fallbacks).`);
      }

      // 2) Lê site raiz: sites/{usuario}  (FALLBACK)
      const site = await getData(["sites", USUARIO]);

      /* ====== Aplicações em ordem de prioridade ====== */

      // Meta (título/subtítulo/bio)
      const meta = page?.meta || site?.meta;
      if(meta){
        textIf($("#site-title"),  meta.title   || $("#site-title")?.textContent);
        document.title = meta.title || document.title;
        textIf($("#site-tagline"), meta.tagline|| $("#site-tagline")?.textContent);
        textIf($("#site-bio"),     meta.bio    || $("#site-bio")?.textContent);
      }

      // Logo: page.logoUrl || page.hero.logoUrl || site.theme.logoUrl
      applyLogo(page?.logoUrl || page?.hero?.logoUrl || site?.theme?.logoUrl);

      // Background: prioriza page.bg; se tiver assetsBase, concatena
      const assetsBase = page?.assetsBase || site?.assetsBase || "";
      applyBackground(page?.bg || site?.bg, assetsBase);

      // Capa do catálogo: page.catalogCover || site.catalogCover
      const cover = page?.catalogCover || site?.catalogCover;
      if(cover && $("#catalog-cover")){
        $("#catalog-cover").src = assetsBase ? (assetsBase + cover) : cover;
      } else if (page?.hero?.cover && $("#catalog-cover")){
        $("#catalog-cover").src = page.hero.cover;
      }

      // Social
      applySocial(page?.social || site?.social);

      // Rotas (catálogo/videos)
      applyRoutes(page?.routes || site?.routes);

      // Shorts e avaliações
      applyShorts(page?.shortsIds);
      applyReviews(page?.reviews);

      console.log("USUARIO:", USUARIO, { page, site });
    })().catch(err => {
      console.error("Erro geral:", err);
      showDiag("Erro ao inicializar. Veja o console (F12).");
    });
  </script>
</body>
</html>
